<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lottery Ticket Generator (Mega Millions, Powerball, Multi-Draw)</title>
  <style>
    body { background: #252858; color: #fff; font-family: sans-serif; }
    .container { margin: 6em auto; width: 410px; background: #334161; padding: 2.2em 2em; border-radius: 12px; box-shadow: 0 5px 32px #0008; }
    h2 { margin-bottom: 1.3em; text-align: center; }
    select, input[type="number"] {
      font-size: 1em; margin: 0 .5em .8em .6em; padding: .25em .7em;
      border-radius: 6px; border: none; color: #242958; background: #ececec
    }
    .picker { text-align: center; margin-bottom:1.3em;}
    button {
      display: block; margin: 1.7em auto 1.2em auto; padding: 13px 32px;
      font-size: 1.08em; background: #ffa600; color: #252858;
      border: none; border-radius: 9px; cursor: pointer;
      font-weight: bold; transition: 0.1s;
    }
    button:disabled { background: #4b626e; cursor: not-allowed; color: #ccc; }
    .ticketblock { background: #253051; margin: 1.1em 0; border-radius: 8px; padding: .7em .8em .4em; }
    .result { font-size: 1.2em; text-align: center; }
    .mm-balls { margin-top: .2em; text-align: center; }
    .ball { display: inline-block; width: 2.15em; height: 2.15em; margin: 0.15em 0.20em; line-height: 2.15em; border-radius: 50%; background: #fafafa; color: #252858; font-weight: bold; font-size: 1.13em; box-shadow: 0 2px 7px #0006; border: 3px solid #e6e6e6;}
    .megaball { background: #ffd600; color: #222; border: 3px solid #ffac22; }
    .powerball { background: #ea3131; color: #fff; border: 3px solid #d68a8a;}
    .err { color: #ffa600; font-size: 1.08em; margin: 0.8em 0 0 0; text-align: center; }
    .timer { font-size: 0.96em; color: #ffd600; text-align: center; margin-top: 0.23em; }
    label { font-size:1.02em;}
  </style>
</head>
<body>
  <div class="container">
    <h2>Lottery Ticket Generator <span style="font-size:1.14em">ðŸŽ²</span></h2>
    <div class="picker">
      <form id="lottoform" onsubmit="event.preventDefault(); getTickets();">
        <label>
          Game:&nbsp;
          <select id="gametype">
            <option value="megamillions">Mega Millions</option>
            <option value="powerball">Powerball</option>
          </select>
        </label>
        <label>
          Multi-Draw:
          <input id="multidraw" type="number" min="1" max="10" value="1" style="width:50px" />
        </label>
        <button id="getBtn" type="submit">Get Ticket(s)</button>
      </form>
    </div>
    <div class="timer" id="cooldown"></div>
    <div class="err" id="error"></div>
    <div class="result" id="result"></div>
  </div>
  <script>
    let cooldown = 0, cooldownTimer = null;
    const cooldownSeconds = 60;

    function startCooldown() {
      cooldown = cooldownSeconds;
      updateCooldownText();
      document.getElementById("getBtn").disabled = true;
      cooldownTimer = setInterval(() => {
        --cooldown;
        updateCooldownText();
        if (cooldown <= 0) {
          clearInterval(cooldownTimer);
          document.getElementById("getBtn").disabled = false;
          document.getElementById("cooldown").textContent = "";
        }
      }, 1000);
    }
    function updateCooldownText() {
      document.getElementById("cooldown").textContent = cooldown > 0
        ? `Cooldown: Please wait ${cooldown} second${cooldown === 1 ? '' : 's'}...` : "";
    }

    function scaleRaw(val, min, max) {
      return Math.floor((val / 65535) * (max - min + 1)) + min;
    }

    async function getTickets() {
      document.getElementById("error").textContent = "";
      document.getElementById("result").textContent = "";
      // Get options
      const gametype = document.getElementById("gametype").value;
      let tickets = Math.max(1, Math.min(10, parseInt(document.getElementById("multidraw").value, 10)||1));
      // Set rules
      let rules = {
        megamillions: { nWhite:5, whiteMin:1, whiteMax:70, megaMin:1, megaMax:24, megaLabel:"Mega Ball", megaClass:"megaball" },
        powerball:    { nWhite:5, whiteMin:1, whiteMax:69, megaMin:1, megaMax:26, megaLabel:"Powerball", megaClass:"powerball" }
      }[gametype];
      
      // Figure out how many random 16-bit ints needed
      // For safety, fetch up to 12 per ticket to allow for rerolls (no duplicates) in rare event.
      const apiNeeded = tickets * (rules.nWhite + 2); // a bit more than the minimal
      startCooldown();

      try {
        const url = `https://qrng.anu.edu.au/API/jsonI.php?length=${apiNeeded}&type=uint16`;
        const response = await fetch(url);
        if (!response.ok) throw new Error("Network error.");
        const data = await response.json();
        if (!data.success || !data.data || data.data.length < tickets * rules.nWhite) throw new Error("API error!");
        let raw = data.data.slice();
        let resHtml = '';
        let pos = 0;
        for(let t=0; t<tickets; ++t) {
          // Get unique white balls
          let balls = [];
          let attempts = 0; // fail-safe
          while(balls.length < rules.nWhite && attempts < 40) {
            let v = scaleRaw(raw[(pos++) % raw.length], rules.whiteMin, rules.whiteMax);
            if(!balls.includes(v)) balls.push(v);
            attempts++;
          }
          balls.sort((a,b)=>a-b);
          // Get Mega or Powerball
          let mega = scaleRaw(raw[(pos++) % raw.length], rules.megaMin, rules.megaMax);

          resHtml += `<div class="ticketblock">
            <div class="mm-balls">
              ${gametype === "megamillions" ? "Mega Millions" : "Powerball"} Ticket #${t+1}:<br>
              <span>White Balls:</span>
              ${balls.map(n=>`<span class="ball">${n}</span>`).join('')}
              <br>
              <span>${rules.megaLabel}:</span>
              <span class="ball ${rules.megaClass}">${mega}</span>
            </div>
          </div>`;
        }
        document.getElementById("result").innerHTML = resHtml;
      } catch (e) {
        document.getElementById("error").textContent = "Sorry! Couldn't get quantum ticket(s).";
      }
    }
  </script>
</body>
</html>
